#!/bin/sh

# Exit if no stash exists
if ! git stash list | grep -q .; then
  exit 0
fi

echo "ðŸ“¦ Git stash detected:"
git stash list | head -n 1
echo ""


printf "â“ Apply latest stash before push? (y/n): " > /dev/tty
read answer < /dev/tty

if [ "$answer" = "y" ] || [ "$answer" = "Y" ]; then
  echo "ðŸ‘‰ Applying stash..." > /dev/tty
  git stash apply stash@{0}

  if git diff --name-only --diff-filter=U | grep -q .; then
    echo "" > /dev/tty
    echo "âŒ Merge conflicts detected after applying stash." > /dev/tty
    echo "Resolve conflicts, then push manually." > /dev/tty
    exit 1
  fi

  echo "âœ… Stash applied successfully." > /dev/tty
else
  echo "âž¡ï¸ Skipping stash apply." > /dev/tty
fi

exit 0

